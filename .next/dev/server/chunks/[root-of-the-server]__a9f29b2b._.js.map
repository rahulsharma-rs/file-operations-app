{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///Users/rahulsharma/Downloads/file-operations-app/app/api/download/route.ts"],"sourcesContent":["\nimport { NextRequest, NextResponse } from 'next/server'\nimport fs from 'fs'\nimport path from 'path'\nimport os from 'os'\nimport { Readable } from 'stream'\n\nexport async function GET(req: NextRequest) {\n    const { searchParams } = new URL(req.url)\n    const filePath = searchParams.get('path')\n\n    if (!filePath) {\n        return new NextResponse(\"Missing path\", { status: 400 })\n    }\n\n    const homeDir = os.homedir()\n    // Validate path is within home (simple check)\n    // Note: real app should handle symlinks carefully, but 'startsWith' provides basic containment.\n    if (!filePath.startsWith(homeDir)) {\n        return new NextResponse(\"Access denied\", { status: 403 })\n    }\n\n    try {\n        const stats = await fs.promises.stat(filePath)\n        if (!stats.isFile()) {\n            return new NextResponse(\"Not a file\", { status: 400 })\n        }\n\n        const stream = fs.createReadStream(filePath)\n\n        // Convert Node stream to Web ReadableStream\n        // @ts-ignore\n        const readable = Readable.toWeb(stream) as ReadableStream\n\n        const headers = new Headers()\n        headers.set('Content-Disposition', `attachment; filename=\"${path.basename(filePath)}\"`)\n        headers.set('Content-Length', stats.size.toString())\n\n        return new NextResponse(readable, {\n            headers\n        })\n\n    } catch (e) {\n        console.error(e)\n        return new NextResponse(\"File not found\", { status: 404 })\n    }\n}\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,IAAI,GAAgB;IACtC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;IACxC,MAAM,WAAW,aAAa,GAAG,CAAC;IAElC,IAAI,CAAC,UAAU;QACX,OAAO,IAAI,gJAAY,CAAC,gBAAgB;YAAE,QAAQ;QAAI;IAC1D;IAEA,MAAM,UAAU,wGAAE,CAAC,OAAO;IAC1B,8CAA8C;IAC9C,gGAAgG;IAChG,IAAI,CAAC,SAAS,UAAU,CAAC,UAAU;QAC/B,OAAO,IAAI,gJAAY,CAAC,iBAAiB;YAAE,QAAQ;QAAI;IAC3D;IAEA,IAAI;QACA,MAAM,QAAQ,MAAM,wGAAE,CAAC,QAAQ,CAAC,IAAI,CAAC;QACrC,IAAI,CAAC,MAAM,MAAM,IAAI;YACjB,OAAO,IAAI,gJAAY,CAAC,cAAc;gBAAE,QAAQ;YAAI;QACxD;QAEA,MAAM,SAAS,wGAAE,CAAC,gBAAgB,CAAC;QAEnC,4CAA4C;QAC5C,aAAa;QACb,MAAM,WAAW,iHAAQ,CAAC,KAAK,CAAC;QAEhC,MAAM,UAAU,IAAI;QACpB,QAAQ,GAAG,CAAC,uBAAuB,CAAC,sBAAsB,EAAE,4GAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC;QACtF,QAAQ,GAAG,CAAC,kBAAkB,MAAM,IAAI,CAAC,QAAQ;QAEjD,OAAO,IAAI,gJAAY,CAAC,UAAU;YAC9B;QACJ;IAEJ,EAAE,OAAO,GAAG;QACR,QAAQ,KAAK,CAAC;QACd,OAAO,IAAI,gJAAY,CAAC,kBAAkB;YAAE,QAAQ;QAAI;IAC5D;AACJ"}}]
}